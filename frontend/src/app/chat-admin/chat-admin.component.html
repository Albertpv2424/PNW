<div class="admin-chat-container">
  <div class="admin-chat-sidebar">
    <h3>Conversaciones activas</h3>
    <div *ngIf="loading" class="loading-indicator">Cargando...</div>
    <div *ngIf="!loading && sessions.length === 0" class="no-sessions">
      No hay conversaciones activas.
    </div>
    <div class="session-list">
      <div *ngFor="let session of sessions"
           class="session-item"
           [class.active]="session.session_id === selectedSessionId"
           (click)="selectSession(session.session_id)">
        <div class="session-info">
          <div class="session-header">
            <span class="user-name">{{ session.user_name || session.user_id }}</span>
            <span class="session-time">{{ formatTime(session.last_message_time) }}</span>
          </div>
          <div class="session-preview">
            {{ session.last_message || 'No hay mensajes' }}
          </div>
        </div>
        <div *ngIf="session.unread_count > 0" class="unread-badge">
          {{ session.unread_count }}
        </div>
      </div>
    </div>
  </div>

  <div class="admin-chat-main">
    <div *ngIf="!selectedSessionId" class="no-session-selected">
      Selecciona una conversación para ver los mensajes.
    </div>

    <div *ngIf="selectedSessionId" class="chat-content">
      <div class="admin-chat-messages">
        <div *ngIf="loading" class="loading-indicator">Cargando mensajes...</div>
        <div *ngIf="!loading && messages.length === 0" class="no-messages">
          No hay mensajes en esta conversación.
        </div>
        <div *ngFor="let message of messages"
             class="message-item"
             [class.admin-message]="message.is_admin"
             [class.user-message]="!message.is_admin">
          <div class="message-content">
            {{ message.message }}
          </div>
          <div class="message-time">
            {{ formatTime(message.created_at) }}
          </div>
        </div>
      </div>

      <div class="admin-chat-input">
        <textarea
          [(ngModel)]="newMessage"
          placeholder="Escribe un mensaje..."
          (keydown.enter)="$event.preventDefault(); sendMessage()">
        </textarea>
        <button (click)="sendMessage()">Enviar</button>
      </div>
    </div>
  </div>
</div>