<!-- Background div -->
<div class="background-container"></div>

<div class="home-container">
  <!-- Header section with user information -->
  <header class="header">
    <div class="logo-container">
      <img src="../../assets/logo.jpg" alt="Logo" class="logo">
    </div>
    <div class="user-info">
      <span *ngIf="username">Bienvenido, <strong>{{ username }}</strong></span>
      <button (click)="logout()" class="logout-button">Cerrar sesión</button>
    </div>
  </header>

  <h1>Deportes Disponibles</h1>

  <div *ngIf="error" class="alert alert-danger">
      {{ error }}
  </div>

  <div *ngIf="loading" class="alert alert-info">
      Cargando datos...
  </div>

  <div class="leagues-container">
      @for (sport of sports; track sport.key) {
          <div class="league-section">
              <h2>{{ sport.title }}</h2>
              <button (click)="loadOdds(sport.key)" class="btn-primary">
                  Ver Cuotas
              </button>

              @if (selectedSportKey === sport.key) {
                  <div class="odds-container">
                      <h3>Cuotas para {{ sport.title }}</h3>

                      @for (event of odds; track event.home_team) {
                          <div class="match-card">
                            <div class="match-header">
                               <h3>{{ event.home_team }} vs {{ event.away_team }}</h3>
                                <span>{{ event.commence_time | date:'dd/MM/yyyy HH:mm' }}</span>
                             </div>
                              <div class="match-teams">
                                  <div class="team">
                                      <span>{{ event.home_team }}</span>
                                  </div>
                                  <div class="vs">VS</div>
                                  <div class="team">
                                      <span>{{ event.away_team }}</span>
                                  </div>
                              </div>
                              <div class="odds">
                                  @if (event.bookmakers.length > 0) {
                                      @for (bookmaker of event.bookmakers; track bookmaker.name) {
                                          @if (bookmaker.markets && bookmaker.markets.length > 0) {
                                              @for (outcome of bookmaker.markets[0].outcomes; track outcome.name) {
                                                  <button 
                                                    class="odd-button"
                                                    (click)="openBetPopup(
                                                      outcome.name === 'Draw' ? 'Empate' : (outcome.name === event.home_team ? event.home_team : event.away_team), 
                                                      outcome.name === 'Draw' ? 'Empate' : 'Ganador', 
                                                      outcome.price,
                                                      event.home_team,
                                                      event.away_team,
                                                      event.id || ''
                                                    )"
                                                  >
                                                      {{ outcome.name }}: {{ outcome.price }}
                                                  </button>
                                              }
                                          }
                                      }
                                  } @else {
                                      <div class="no-odds-message">
                                          No hay cuotas disponibles para este partido.
                                      </div>
                                  }
                              </div>
                          </div>
                      }
                  </div>
              }
          </div>
      }
  </div>
</div>

<!-- Componente de pop-up de apuesta -->
<app-bet-popup
  [visible]="showBetPopup"
  [teamName]="selectedBet.teamName"
  [betType]="selectedBet.betType"
  [odds]="selectedBet.odds"
  [matchInfo]="selectedBet.matchInfo"
  (close)="closeBetPopup()"
  (placeBet)="placeBet($event)"
></app-bet-popup>

<!-- Añadir el componente de apuesta combinada al final -->
<app-combined-bet></app-combined-bet>
